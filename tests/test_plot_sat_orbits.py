"""Test the satellite orbit plots."""

from datetime import datetime, timedelta, timezone

import pytest
from pytest_mock import MockerFixture
from skyfield.api import wgs84


@pytest.mark.visual
def test_plot_gnss_orbits(mocker: MockerFixture) -> None:
    """Test the GNSS orbit plots."""
    # mock the results which would be obtained from `space-track.org` by an API request
    # for GNSS satellites
    mock_space_track_tles = [
        "0 NAVSTAR 43 (USA 132)",
        "1 24876U 97035A   24302.39915371  .00000082  00000-0  00000-0 0  9990",
        "2 24876  55.7149 121.9219 0085478  54.7594 306.0903  2.00561667199981",
        "0 NAVSTAR 47 (USA 150)",
        "1 26360U 00025A   24302.01239243 -.00000089  00000-0  00000-0 0  9997",
        "2 26360  54.7713  43.4781 0039809 220.0395 310.3282  2.00569476179299",
        "0 NAVSTAR 48 (USA 151)",
        "1 26407U 00040A   24302.49747413 -.00000049  00000-0  00000-0 0  9997",
        "2 26407  55.0170 238.8805 0140960 296.6575  61.8162  2.00562089177981",
        "0 NAVSTAR 51 (USA 166)",
        "1 27663U 03005A   24302.53555285 -.00000049  00000-0  00000-0 0  9995",
        "2 27663  55.0542 238.6902 0139702  48.0742 118.4102  2.00567274159346",
        "0 NAVSTAR 54 (USA 177)",
        "1 28190U 04009A   24302.34195817 -.00000045  00000-0  00000-0 0  9992",
        "2 28190  55.3409 299.7136 0098912 154.3031  24.7733  2.00555291150978",
        "0 NAVSTAR 56 (USA 180)",
        "1 28474U 04045A   24302.52341083 -.00000091  00000-0  00000-0 0  9996",
        "2 28474  55.3972 348.8727 0165428 296.0256  61.4323  2.00562758146457",
        "0 ANIK F1-R",
        "1 28868U 05036A   24302.54213067 -.00000068  00000-0  00000-0 0  9990",
        "2 28868   2.7748  83.9460 0001899 108.3411 292.9922  1.00272704 40470",
        "0 NAVSTAR 57 (USA 183)",
        "1 28874U 05038A   24302.80833236 -.00000045  00000-0  00000-0 0  9999",
        "2 28874  55.3859 297.1605 0137383 286.3682 254.7048  2.00576500139879",
        "0 INMARSAT 4-F2",
        "1 28899U 05044A   24302.23440021 -.00000255  00000-0  00000-0 0  9999",
        "2 28899   4.3404  42.8751 0003168 193.9995  28.0849  1.00271274 69531",
        "0 NAVSTAR 58 (USA 190)",
        "1 29486U 06042A   24302.43414236  .00000037  00000-0  00000-0 0  9999",
        "2 29486  54.6755 175.0092 0105206  42.5918 128.4220  2.00573558132426",
        "0 NAVSTAR 59 (USA 192)",
        "1 29601U 06052A   24302.61425335 -.00000048  00000-0  00000-0 0  9994",
        "2 29601  55.0886 237.6743 0085662  83.7398 277.2254  2.00575028131440",
        "0 NAVSTAR 60 (USA 196)",
        "1 32260U 07047A   24302.42390276  .00000052  00000-0  00000-0 0  9992",
        "2 32260  53.6829 104.7294 0159502  78.3554 283.4542  2.00557978124849",
        "0 COSMOS 2433 (GLONASS)",
        "1 32275U 07052A   24302.95763519 -.00000044  00000-0  00000-0 0  9998",
        "2 32275  65.8812 335.9267 0005745 243.6091 116.3989  2.13104208132354",
        "0 NAVSTAR 61 (USA 199)",
        "1 32384U 07062A   24302.48505815 -.00000044  00000-0  00000-0 0  9991",
        "2 32384  55.5283 298.0558 0027921 157.9182  14.9221  2.00554527123545",
        "0 NAVSTAR 62 (USA 201)",
        "1 32711U 08012A   24302.83597702  .00000045  00000-0  00000-0 0  9996",
        "2 32711  54.4500 173.7232 0189855 240.2343 117.9539  2.00572217121794",
        "0 NAVSTAR 64 (USA 206)",
        "1 35752U 09043A   24302.05629226 -.00000074  00000-0  00000-0 0  9993",
        "2 35752  55.7841  51.0099 0055376  76.0517  93.9647  2.00561801111385",
        "0 COSMOS 2457 (GLONASS)",
        "1 36112U 09070B   24302.93791119  .00000038  00000-0  00000-0 0  9991",
        "2 36112  64.6630  91.2243 0006216 146.9693  17.2998  2.13101198115722",
        "0 NAVSTAR 65 (USA 213)",
        "1 36585U 10022A   24302.19045865 -.00000049  00000-0  00000-0 0  9995",
        "2 36585  54.4036 232.6322 0117647  62.2528 321.7587  2.00558304105626",
        "0 BEIDOU 5",
        "1 36828U 10036A   24302.57896684 -.00000073  00000-0  00000-0 0  9992",
        "2 36828  54.2530 168.3562 0042547 206.5891 336.2931  1.00292588 52113",
        "0 BEIDOU 6",
        "1 37210U 10057A   24302.53799263 -.00000106  00000-0  00000-0 0  9999",
        "2 37210   2.1669  69.9250 0008994 173.0443 148.0843  1.00270652 51302",
        "0 BEIDOU 7",
        "1 37256U 10068A   24302.87062564 -.00000208  00000-0  00000-0 0  9998",
        "2 37256  48.6366 279.1855 0039166 218.5524 320.3022  1.00260364 50815",
        "0 BEIDOU 8",
        "1 37384U 11013A   24302.72762041 -.00000197  00000-0  00000-0 0  9999",
        "2 37384  61.5535  45.8294 0032293 178.4698 183.1354  1.00275625 49686",
        "0 GSAT 8",
        "1 37605U 11022A   24302.57436331  .00000089  00000-0  00000-0 0  9997",
        "2 37605   0.5813  89.2942 0008158 161.5031  48.4751  1.00272680 47234",
        "0 COSMOS 2476 (GLONASS)",
        "1 37867U 11064A   24302.07014994  .00000049  00000-0  00000-0 0  9991",
        "2 37867  64.9485  93.0825 0022259 230.5070 126.9013  2.13101628101034",
        "0 COSMOS 2477 (GLONASS)",
        "1 37868U 11064B   24302.96855678  .00000043  00000-0  00000+0 0  9995",
        "2 37868  64.9559  93.1258 0019445 230.6862 274.7365  2.13103068101044",
        "0 LUCH 5A",
        "1 37951U 11074B   24302.23909175 -.00000038  00000-0  00000-0 0  9997",
        "2 37951   7.2256  82.8526 0004490 128.9047  78.3902  1.00274014 47063",
        "0 BEIDOU 11",
        "1 38091U 12008A   24302.57505837  .00000064  00000-0  00000-0 0  9993",
        "2 38091   2.0870  70.7318 0009244 219.5959  12.7967  1.00271549 46387",
        "0 SES 5",
        "1 38652U 12036A   24302.35535597  .00000038  00000-0  00000+0 0  9999",
        "2 38652   0.0666 294.3611 0002138 289.2491 306.5102  1.00272220 45089",
        "0 BEIDOU 15",
        "1 38775U 12050B   24302.27390003  .00000006  00000-0  00000-0 0  9999",
        "2 38775  56.0246  82.7189 0010464 346.0171  13.9451  1.86231098 82198",
        "0 NAVSTAR 67 (USA 239)",
        "1 38833U 12053A   24302.02287707  .00000042  00000-0  00000-0 0  9996",
        "2 38833  53.5189 168.0417 0159831  58.2119 303.4272  2.00560626 87461",
        "0 BEIDOU 16",
        "1 38953U 12059A   24302.58009742 -.00000169  00000-0  00000-0 0  9998",
        "2 38953   2.8983  79.3892 0006508 295.5517 315.3874  1.00271728 43928",
        "0 COSMOS 2485 (GLONASS)",
        "1 39155U 13019A   24302.01536273  .00000051  00000-0  00000-0 0  9991",
        "2 39155  65.1049  93.6964 0022714 226.5968 133.2202  2.13101788 89552",
        "0 NAVSTAR 69 (USA 248)",
        "1 39533U 14008A   24302.87701116  .00000044  00000-0  00000-0 0  9996",
        "2 39533  53.5999 173.6242 0072711 220.2989 139.2508  2.00549945 77729",
        "0 ASTRA 5B",
        "1 39617U 14011B   24302.29424299  .00000140  00000-0  00000-0 0  9990",
        "2 39617   0.0687 309.1294 0003705 283.6043 293.8403  1.00270687 38683",
        "0 COSMOS 2492 (GLONASS)",
        "1 39620U 14012A   24302.90908784 -.00000042  00000-0  00000+0 0  9990",
        "2 39620  65.6157 334.1282 0013592 308.6443  51.2999  2.13103315 82535",
        "0 IRNSS 1B",
        "1 39635U 14017A   24302.43144501  .00000084  00000-0  00000-0 0  9994",
        "2 39635  29.1628 250.5733 0019706 186.2619 170.7097  1.00273495 38808",
        "0 LUCH 5V",
        "1 39727U 14023A   24302.57306531 -.00000261  00000-0  00000-0 0  9999",
        "2 39727   3.6323  75.0135 0004324 174.8732  88.5994  1.00270154 38377",
        "0 NAVSTAR 70 (USA 251)",
        "1 39741U 14026A   24302.16327714 -.00000096  00000-0  00000-0 0  9995",
        "2 39741  56.6953 354.7160 0033639 312.9247  46.8524  2.00558949 76563",
        "0 NAVSTAR 71 (USA 256)",
        "1 40105U 14045A   24302.74889266  .00000068  00000-0  00000-0 0  9999",
        "2 40105  54.9943 112.2700 0029783 116.6442 243.6960  2.00575306 74113",
        "0 IRNSS 1C",
        "1 40269U 14061A   24302.50842106 -.00000152  00000-0  00000-0 0  9999",
        "2 40269   4.9974 101.5359 0019162   7.9143 193.9854  1.00271839 36709",
        "0 NAVSTAR 72 (USA 258)",
        "1 40294U 14068A   24302.12832285 -.00000067  00000-0  00000-0 0  9994",
        "2 40294  56.5352  54.0631 0054707  65.6861 294.8780  2.00568385 73231",
        "0 COSMOS 2501 (GLONASS)",
        "1 40315U 14075A   24302.87210922 -.00000017  00000-0  00000-0 0  9991",
        "2 40315  63.6175 211.0326 0019731 207.4654 152.4670  2.13101450 77148",
        "0 NAVSTAR 73 (USA 260)",
        "1 40534U 15013A   24302.75780965 -.00000044  00000-0  00000-0 0  9993",
        "2 40534  53.3010 228.8644 0093346  31.5313 329.0266  2.00557648 69869",
        "0 GALILEO 7 (263)",
        "1 40544U 15017A   24302.07034657 -.00000097  00000-0  00000-0 0  9991",
        "2 40544  56.9171 357.8576 0005709 251.7128 108.2842  1.70476384 59027",
        "0 IRNSS 1D",
        "1 40547U 15018A   24302.79990495 -.00000304  00000-0  00000-0 0  9996",
        "2 40547  27.2257 250.3906 0018321 189.1524 357.8906  1.00275224 35006",
        "0 NAVSTAR 74 (USA 262)",
        "1 40730U 15033A   24302.42069181 -.00000045  00000-0  00000+0 0  9997",
        "2 40730  54.4815 291.6109 0097803  20.1266 340.2587  2.00560301 68049",
        "0 GALILEO 10 (206)",
        "1 40890U 15045B   24302.90035375 -.00000032  00000-0  00000-0 0  9995",
        "2 40890  55.1603 238.0721 0002757   7.4775 352.5073  1.70473063 56879",
        "0 BD-20",
        "1 40938U 15053A   24302.36810918 -.00000160  00000-0  00000-0 0  9993",
        "2 40938  50.1551 265.8452 0052323 189.9872 170.5956  1.00276157 33372",
        "0 GSAT 15",
        "1 41028U 15065A   24302.51050619 -.00000254  00000-0  00000+0 0  9991",
        "2 41028   0.0571  77.1104 0002514 132.0212 105.5196  1.00272442 32872",
        "0 GALILEO 12 (269)",
        "1 41174U 15079A   24302.48343674  .00000070  00000-0  00000+0 0  9995",
        "2 41174  55.4896 117.6506 0002057 358.4504   1.5936  1.70474338 55185",
        "0 IRNSS 1E",
        "1 41241U 16003A   24302.29947365 -.00000274  00000-0  00000-0 0  9992",
        "2 41241  31.9305  71.4941 0021926 180.8710   4.3237  1.00278176 32091",
        "0 NAVSTAR 76 (USA 266)",
        "1 41328U 16007A   24302.06476118  .00000070  00000-0  00000-0 0  9993",
        "2 41328  55.1843 113.1695 0081550 238.5157 120.7215  2.00555397 63869",
        "0 COSMOS 2514 (GLONASS)",
        "1 41330U 16008A   24302.38575051 -.00000043  00000-0  00000-0 0  9999",
        "2 41330  65.3465 333.4161 0013021 218.0411 141.9312  2.13102734 67903",
        "0 IRNSS 1F",
        "1 41384U 16015A   24302.56984553  .00000168  00000-0  00000-0 0  9994",
        "2 41384   3.8771 113.1286 0023127 176.5321 345.4330  1.00276765 31684",
        "0 IRNSS 1G",
        "1 41469U 16027A   24302.56785574 -.00000325  00000-0  00000-0 0  9999",
        "2 41469   3.7448 114.1846 0002429   5.3048 251.9615  1.00273548 31197",
        "0 GALILEO 14 (26B)",
        "1 41549U 16030A   24302.23947938 -.00000034  00000-0  00000-0 0  9997",
        "2 41549  55.3091 238.1158 0003603 338.0878  21.8769  1.70473113 52495",
        "0 BD-2-G7",
        "1 41586U 16037A   24302.51389453 -.00000348  00000-0  00000+0 0  9995",
        "2 41586   1.6973  66.6359 0006658 345.0770 281.1657  1.00268638 30791",
        "0 GALILEO 17 (26D)",
        "1 41861U 16069C   24302.41288678  .00000069  00000-0  00000-0 0  9992",
        "2 41861  55.1530 117.6247 0001638 272.4578  87.5683  1.70474823 49345",
        "0 GALILEO 18 (26E)",
        "1 41862U 16069D   24302.55827329  .00000069  00000-0  00000+0 0  9999",
        "2 41862  55.1512 117.6141 0000710 273.4149  86.6216  1.70474575 49474",
        "0 QZS-3",
        "1 42917U 17048A   24302.54910439 -.00000343  00000-0  00000-0 0  9990",
        "2 42917   0.0686 141.8294 0002420  76.0330 144.2645  1.00273028 26277",
        "0 COSMOS 2522 (GLONASS)",
        "1 42939U 17055A   24302.22553644 -.00000027  00000-0  00000-0 0  9997",
        "2 42939  64.0788 212.2222 0007600 237.0145 122.9447  2.13102006 55251",
        "0 QZS-4",
        "1 42965U 17062A   24302.45003741 -.00000334  00000-0  00000-0 0  9998",
        "2 42965  40.4503 351.1002 0751975 270.4889  77.2189  1.00266052 25821",
        "0 GALILEO 20 (2C6)",
        "1 43056U 17079B   24302.16614225 -.00000035  00000-0  00000-0 0  9999",
        "2 43056  55.2868 237.9377 0003802 291.5060  68.4340  1.70473924 42826",
        "0 GALILEO 21 (2C7)",
        "1 43057U 17079C   24302.97325173 -.00000032  00000-0  00000-0 0  9997",
        "2 43057  55.2841 237.9141 0003443 309.9480  50.0029  1.70473852 42829",
        "0 BEIDOU 3M3",
        "1 43107U 18003A   24302.26222819 -.00000068  00000-0  00000-0 0  9995",
        "2 43107  54.8367 323.0382 0002191  73.9226 286.1473  1.86232604 46231",
        "0 BEIDOU 3M4",
        "1 43108U 18003B   24302.74072395 -.00000068  00000-0  00000+0 0  9990",
        "2 43108  54.8292 323.0066 0005182 259.8128 100.1742  1.86231075 46254",
        "0 COSMOS 2527 (GLONASS)",
        "1 43508U 18053A   24302.65422345  .00000048  00000-0  00000-0 0  9991",
        "2 43508  65.2648  93.8545 0007886 214.5658 145.3872  2.13102341 49568",
        "0 GALILEO 26 (2C2)",
        "1 43565U 18060B   24302.72664784 -.00000094  00000-0  00000-0 0  9997",
        "2 43565  57.3008 357.8760 0005346 242.2497 117.7574  1.70476048 39047",
        "0 GALILEO 23 (2C9)",
        "1 43566U 18060C   24302.94833310 -.00000093  00000-0  00000-0 0  9994",
        "2 43566  57.2993 357.8717 0004996 271.0916  88.9132  1.70476238 39026",
        "0 GALILEO 24 (2C0)",
        "1 43567U 18060D   24302.58247028 -.00000094  00000-0  00000-0 0  9991",
        "2 43567  57.2998 357.8818 0004790 266.0069  93.9993  1.70476374 39009",
        "0 BEIDOU 3G1",
        "1 43683U 18085A   24302.59121812 -.00000271  00000-0  00000-0 0  9997",
        "2 43683   2.5185 104.7510 0001737  47.0005 238.5471  1.00268636 22072",
        "0 COSMOS 2529 (GLONASS)",
        "1 43687U 18086A   24302.28363181 -.00000026  00000-0  00000-0 0  9993",
        "2 43687  64.2945 212.7686 0008964 260.8864  99.0436  2.13102073 46564",
        "0 NAVSTAR 77 (USA 289)",
        "1 43873U 18109A   24302.72938071  .00000074  00000-0  00000-0 0  9993",
        "2 43873  55.3532 115.7487 0031484 191.7607 179.7047  2.00561297 43110",
        "0 BEIDOU 3 IGSO-1",
        "1 44204U 19023A   24302.68799313 -.00000227  00000-0  00000-0 0  9998",
        "2 44204  57.8425  43.8332 0024943 209.2166 150.4943  1.00261977  1222",
        "0 BEIDOU 2 G8",
        "1 44231U 19027A   24302.59208691 -.00000241  00000-0  00000-0 0  9992",
        "2 44231   1.8062  74.5586 0004026 188.2932 132.2030  1.00276326 20092",
        "0 COSMOS 2534 (GLONASS)",
        "1 44299U 19030A   24302.34979858 -.00000026  00000-0  00000-0 0  9994",
        "2 44299  64.3677 212.7323 0011084 284.0556 260.8688  2.13102123 42208",
        "0 BEIDOU 3 IGSO-2",
        "1 44337U 19035A   24302.51554525 -.00000079  00000-0  00000+0 0  9998",
        "2 44337  55.1825 164.1006 0034554 201.3126 334.8330  1.00255986 19711",
        "0 NAVSTAR 78 (USA 293)",
        "1 44506U 19056A   24302.58646751 -.00000096  00000-0  00000-0 0  9999",
        "2 44506  55.8288 354.8074 0048265 192.8496 340.3436  2.00557728 38103",
        "0 BEIDOU 3M23",
        "1 44542U 19061A   24302.14848837 -.00000021  00000-0  00000-0 0  9994",
        "2 44542  54.4277 202.8703 0008814   6.0011 354.0583  1.86229487 34676",
        "0 BEIDOU 3 IGSO-3",
        "1 44709U 19073A   24302.36521303 -.00000181  00000-0  00000-0 0  9999",
        "2 44709  55.8270 287.3118 0040853 191.1327 168.7345  1.00261729 18479",
        "0 COSMOS 2544 (GLONASS)",
        "1 44850U 19088A   24302.59838330  .00000047  00000-0  00000-0 0  9998",
        "2 44850  65.2514  93.6908 0011939 246.4903 113.3885  2.13102106 38008",
        "0 BEIDOU 3M19",
        "1 44864U 19090A   24302.10125314  .00000007  00000-0  00000-0 0  9990",
        "2 44864  56.0390  82.6139 0015789 279.0289 258.9221  1.86231729 33113",
        "0 BEIDOU 3 G2",
        "1 45344U 20017A   24302.57931550 -.00000136  00000-0  00000-0 0  9997",
        "2 45344   2.4972  34.2964 0004149 204.9779  86.7490  1.00271780 17277",
        "0 COSMOS 2545 (GLONASS)",
        "1 45358U 20018A   24302.32596658 -.00000045  00000-0  00000-0 0  9991",
        "2 45358  64.6858 333.3204 0012200 245.0298 114.9070  2.13102659 35949",
        "0 BEIDOU 3 G3",
        "1 45807U 20040A   24302.51389453 -.00000349  00000-0  00000+0 0  9995",
        "2 45807   1.0341  54.6182 0003069 301.6934 336.5824  1.00275688 16101",
        "0 NAVSTAR 79 (USA 304)",
        "1 45854U 20041A   24302.93014306 -.00000073  00000-0  00000+0 0  9990",
        "2 45854  56.2356  52.1829 0049007 195.3925 163.1835  2.00570727 32075",
        "0 GALAXY 30",
        "1 46114U 20056C   24302.68157378  .00000042  00000-0  00000-0 0  9991",
        "2 46114   0.0158 244.6870 0002000 330.6044 302.5877  1.00270281 15318",
        "0 COSMOS 2547 (GLONASS)",
        "1 46805U 20075A   24302.98177362 -.00000017  00000-0  00000-0 0  9990",
        "2 46805  64.5970 212.3923 0007078 238.0815 121.8843  2.13102812 31200",
        "0 NAVSTAR 80 (USA 309)",
        "1 46826U 20078A   24302.20588924 -.00000050  00000-0  00000-0 0  9998",
        "2 46826  54.1332 235.0056 0050325 198.8624 331.2137  2.00560494 29539",
        "0 NAVSTAR 81 (USA 319)",
        "1 48859U 21054A   24302.71962741 -.00000098  00000-0  00000-0 0  9992",
        "2 48859  55.3567 356.3921 0018853 225.7191 138.4106  2.00576785 24793",
        "0 QZS-1R",
        "1 49336U 21096A   24302.30260135 -.00000210  00000-0  00000-0 0  9998",
        "2 49336  36.2227  88.5128 0747623 270.4325 283.0807  1.00277199 11021",
        "0 GALILEO 28 (224)",
        "1 49810U 21116B   24302.25247133 -.00000095  00000-0  00000-0 0  9996",
        "2 49810  57.2912 357.7825 0003344 220.2219 140.3040  1.70476557 18035",
        "0 BEIDOU 3 G4",
        "1 56564U 23066A   24302.53799263 -.00000109  00000-0  00000-0 0  9999",
        "2 56564   1.7947 288.7952 0005221 248.4507 213.8622  1.00272864  5411",
        "0 NVS-01",
        "1 56759U 23076A   24302.58913297 -.00000336  00000-0  00000-0 0  9998",
        "2 56759   3.6588 263.1709 0007021 354.4426 121.4594  1.00275902  5131",
        "0 COSMOS 2569 (GLONASS)",
        "1 57517U 23114A   24302.82829917  .00000043  00000-0  00000-0 0  9990",
        "2 57517  64.9802  92.7842 0008768 291.2889  68.6199  2.13104077  9559",
        "0 BEIDOU-3 M25",
        "1 58654U 23207A   24302.20548713  .00000005  00000-0  00000+0 0  9997",
        "2 58654  55.2239  82.5341 0001121 215.1424 144.8421  1.86232171  5722",
        "0 GALILEO 29 (10C)",
        "1 59598U 24079A   24302.26855029  .00000068  00000-0  00000-0 0  9990",
        "2 59598  54.7688 117.7833 0002576 157.6009 203.6981  1.70474777  3145",
        "0 GALILEO 32 (137)",
        "1 61182U 24167A   24302.16173113 -.00000034  00000-0  00000-0 0  9990",
        "2 61182  55.3975 237.6784 0016414 274.8348  84.9595  1.73176914   697",
    ]
    reference_time = datetime(2024, 10, 28, 8, 54, 0, tzinfo=timezone.utc)
    # São José dos Campos
    receiver_pos = wgs84.latlon(-23.20713241666, -45.861737777, 605.088)

    from scintpy import setup_log
    from scintpy.geom import get_scenario, plot_sat_orbits
    from scintpy.geom.orbit_propagation import _get_sats, _yield_LOS_sats

    setup_log("TRACE")

    sats = _get_sats(mock_space_track_tles)

    print(sats)

    scenarios = []
    for sat, rise_time, set_time in _yield_LOS_sats(
        sats, reference_time, receiver_pos, 5
    ):
        scenarios.append(get_scenario(sat, receiver_pos, rise_time, set_time))

    plot_sat_orbits(scenarios, reference_time)
    # NOTE: that is a visual test.

@pytest.mark.visual
def test_plot_cubesat_orbits(mocker: MockerFixture) -> None:
    """Test the cubesat orbit plots."""
    # mock the results which would be obtained from `space-track.org` by an API request
    # for cubesat satellites
    mock_space_track_tles = [
        "0 CUTE-1",
        "1 27844U 03031E   24302.01598346  .00001552  00000-0  70030-3 0  9995",
        "2 27844  98.6794 307.2369 0010723 116.0615 244.1668 14.23579000106710",
        "0 CUTE-1",
        "1 27844U 03031E   24302.43769508  .00001596  00000-0  71929-3 0  9997",
        "2 27844  98.6794 307.6530 0010744 114.9716 245.2579 14.23580476106741",
        "0 CUTE-1",
        "1 27844U 03031E   24302.78912073  .00001660  00000-0  74754-3 0  9993",
        "2 27844  98.6793 307.9997 0010746 114.0394 246.1910 14.23581976106795",
        "0 CUBESAT XI 4",
        "1 27848U 03031J   24302.49635947  .00001401  00000-0  64131-3 0  9998",
        "2 27848  98.6824 307.8761 0010443 129.8093 230.4006 14.22977309106493",
        "0 CUBESAT XI 4",
        "1 27848U 03031J   24302.49635947  .00001401  00000-0  64131-3 0  9998",
        "2 27848  98.6824 307.8761 0010443 129.8093 230.4006 14.22977309106549",
        "0 CUBESAT XI 4",
        "1 27848U 03031J   24302.56667450  .00001398  00000-0  64013-3 0  9994",
        "2 27848  98.6825 307.9454 0010446 129.6190 230.5912 14.22977471106502",
        "0 CUBESAT XI 5",
        "1 28895U 05043F   24302.33103135  .00008324  00000-0  14229-2 0  9991",
        "2 28895  98.2198  78.6082 0014309 298.1545  61.8214 14.69069688 13994",
        "0 CUBESAT XI 5",
        "1 28895U 05043F   24302.33103135  .00008324  00000-0  14229-2 0  9991",
        "2 28895  98.2198  78.6082 0014309 298.1545  61.8214 14.69069688 14221",
        "0 CUBESAT XI 5",
        "1 28895U 05043F   24302.80780656  .00008707  00000-0  14876-2 0  9995",
        "2 28895  98.2202  79.0878 0014298 296.5797  63.3943 14.69078611 14067",
        "0 CUTE-1.7+APD II",
        "1 32785U 08021C   24302.47698417  .00018759  00000-0  15195-2 0  9996",
        "2 32785  97.7741 267.0576 0008050 242.6018 117.4386 14.99738705895433",
        "0 CUTE-1.7+APD II",
        "1 32785U 08021C   24302.81058196  .00018778  00000-0  15206-2 0  9992",
        "2 32785  97.7741 267.3907 0008100 241.2591 118.7819 14.99750795895484",
        "0 AAUSAT CUBESAT 2",
        "1 32788U 08021F   24302.40043197  .00086578  00000-0  29661-2 0  9998",
        "2 32788  97.6037 284.1065 0008670  76.6005 283.6200 15.29824773898591",
        "0 AAUSAT CUBESAT 2",
        "1 32788U 08021F   24302.40043197  .00086578  00000-0  29661-2 0  9998",
        "2 32788  97.6037 284.1065 0008670  76.6005 283.6200 15.29824773898692",
        "0 AAUSAT CUBESAT 2",
        "1 32788U 08021F   24302.92368643  .00094551  00000-0  32259-2 0  9998",
        "2 32788  97.6036 284.6414 0008554  76.1072 284.1119 15.29923452898671",
        "0 CANX-2",
        "1 32790U 08021H   24302.35685590  .00014247  00000-0  12162-2 0  9996",
        "2 32790  97.7829 265.5453 0009896 250.3068 109.7087 14.97762188895200",
        "0 CANX-2",
        "1 32790U 08021H   24302.42366352  .00015330  00000-0  13079-2 0  9998",
        "2 32790  97.7831 265.6120 0009899 250.0119 110.0037 14.97765507895211",
        "0 SEEDS",
        "1 32791U 08021J   24302.35043437  .00031140  00000-0  19666-2 0  9992",
        "2 32791  97.7049 273.3086 0003576 181.4524 178.6695 15.08998005896566",
        "0 SEEDS",
        "1 32791U 08021J   24302.41674498  .00034182  00000-0  21570-2 0  9992",
        "2 32791  97.7051 273.3752 0003576 181.3970 178.7249 15.09004702896573",
        "0 SEEDS",
        "1 32791U 08021J   24302.88091393  .00036412  00000-0  22947-2 0  9997",
        "2 32791  97.7053 273.8415 0003597 180.0287 180.0942 15.09037197896644",
        "0 SWISSCUBE",
        "1 35932U 09051B   24302.57743229  .00006062  00000-0  12720-2 0  9995",
        "2 35932  98.4502 188.4883 0005678 269.2870  90.7679 14.60012485802012",
        "0 SWISSCUBE",
        "1 35932U 09051B   24302.64596524  .00006132  00000-0  12866-2 0  9996",
        "2 35932  98.4502 188.5581 0005682 268.9688  91.0861 14.60013334802028",
        "0 BEESAT",
        "1 35933U 09051C   24302.33732581  .00005046  00000-0  10700-2 0  9996",
        "2 35933  98.4432 188.9688 0004221 287.5683  72.5055 14.59615081802049",
        "0 BEESAT",
        "1 35933U 09051C   24302.33732581  .00005046  00000-0  10700-2 0  9996",
        "2 35933  98.4432 188.9688 0004221 287.5683  72.5055 14.59615081802128",
        "0 ITUPSAT 1",
        "1 35935U 09051E   24302.17539257  .00004573  00000-0  99430-3 0  9997",
        "2 35935  98.4531 188.5121 0006591 293.9123  66.1385 14.58502914801673",
        "0 ITUPSAT 1",
        "1 35935U 09051E   24302.58701496  .00004804  00000-0  10438-2 0  9995",
        "2 35935  98.4531 188.9307 0006563 292.4816  67.5688 14.58506958801702",
        "0 ITUPSAT 1",
        "1 35935U 09051E   24302.93003255  .00004991  00000-0  10840-2 0  9996",
        "2 35935  98.4531 189.2796 0006558 291.2546  68.7952 14.58510625801757",
        "0 TISAT 1",
        "1 36799U 10035E   24302.62431642  .00032343  00000-0  21363-2 0  9994",
        "2 36799  98.0706 198.1158 0005552 118.1706 242.0082 15.07331032777127",
        "0 AEROCUBE 4.5A",
        "1 38767U 12048K   24302.22304615  .00055952  00000-0  23677-2 0  9993",
        "2 38767  64.6554 244.4863 0111500 335.5061  24.0787 15.17309365280597",
        "0 AEROCUBE 4.5A",
        "1 38767U 12048K   24302.22304615  .00055952  00000-0  23677-2 0  9993",
        "2 38767  64.6554 244.4863 0111500 335.5061  24.0787 15.17309365280597",
        "0 AEROCUBE 4.5B",
        "1 38768U 12048L   24302.33228023  .00128436  00000-0  25432-2 0  9993",
        "2 38768  64.6478 156.6938 0074635 320.5626  39.0091 15.43387965281820",
        "0 AEROCUBE 4.5B",
        "1 38768U 12048L   24302.33228023  .00128436  00000-0  25432-2 0  9993",
        "2 38768  64.6478 156.6938 0074635 320.5626  39.0091 15.43387965281820",
        "0 AEROCUBE 4.5B",
        "1 38768U 12048L   24302.98020787  .00138221  00000-0  27180-2 0  9996",
        "2 38768  64.6475 154.5009 0074457 320.2860  39.2838 15.43564021281924",
        "0 STRAND 1",
        "1 39090U 13009E   24302.48137893  .00001718  00000-0  60086-3 0  9998",
        "2 39090  98.3794 127.1390 0008200 208.6800 151.3936 14.36393855611373",
        "0 STRAND 1",
        "1 39090U 13009E   24302.96899209  .00001762  00000-0  61590-3 0  9997",
        "2 39090  98.3793 127.6134 0008233 207.0751 153.0007 14.36395747611445",
        "0 BRITE-A TUGSAT-1",
        "1 39091U 13009F   24302.27740559  .00001167  00000-0  41591-3 0  9993",
        "2 39091  98.3843 126.2159 0009561 217.8617 142.1898 14.36023375611362",
        "0 BRITE-A TUGSAT-1",
        "1 39091U 13009F   24302.27740559  .00001167  00000-0  41591-3 0  9993",
        "2 39091  98.3843 126.2159 0009561 217.8617 142.1898 14.36023375611373",
        "0 BRITE-A TUGSAT-1",
        "1 39091U 13009F   24302.76514459  .00001206  00000-0  42919-3 0  9994",
        "2 39091  98.3843 126.6905 0009573 216.3359 143.7178 14.36024704611438",
        "0 NEE 01 PEGASUS",
        "1 39151U 13018B   24302.07668255  .00013215  00000-0  14495-2 0  9999",
        "2 39151  98.0494  60.7605 0013652 329.0057  31.0352 14.87779010621728",
        "0 NEE 01 PEGASUS",
        "1 39151U 13018B   24302.27844811  .00012167  00000-0  13351-2 0  9990",
        "2 39151  98.0495  60.9651 0013628 328.3462  31.6933 14.87783104621749",
        "0 NEE 01 PEGASUS",
        "1 39151U 13018B   24302.27844811  .00012167  00000-0  13351-2 0  9990",
        "2 39151  98.0495  60.9651 0013628 328.3462  31.6933 14.87783104621750",
        "0 NEE 01 PEGASUS",
        "1 39151U 13018B   24302.81648645  .00013325  00000-0  14608-2 0  9990",
        "2 39151  98.0498  61.5108 0013608 326.5819  33.4537 14.87797503621827",
        "0 NEE 01 PEGASUS",
        "1 39151U 13018B   24302.81648645  .00013325  00000-0  14608-2 0  9990",
        "2 39151  98.0498  61.5108 0013608 326.5819  33.4537 14.87797503621838",
        "0 NEE 01 PEGASUS",
        "1 39151U 13018B   24302.88374075  .00012628  00000-0  13848-2 0  9990",
        "2 39151  98.0499  61.5791 0013603 326.3524  33.6826 14.87798637621846",
        "0 ESTCUBE 1",
        "1 39161U 13021C   24302.12327820  .00009794  00000-0  13689-2 0  9991",
        "2 39161  97.8140   4.5449 0009463 152.4386 207.7329 14.77780505616757",
        "0 ESTCUBE 1",
        "1 39161U 13021C   24302.46182939  .00009708  00000-0  13567-2 0  9998",
        "2 39161  97.8142   4.8733 0009473 151.4770 208.6961 14.77786608616803",
        "0 ESTCUBE 1",
        "1 39161U 13021C   24302.59724942  .00009658  00000-0  13497-2 0  9994",
        "2 39161  97.8142   5.0046 0009476 151.0914 209.0824 14.77789311616786",
        "0 ESTCUBE 1",
        "1 39161U 13021C   24302.80037937  .00009434  00000-0  13186-2 0  9996",
        "2 39161  97.8142   5.2017 0009500 150.3196 209.8556 14.77792450616854",
        "0 ESTCUBE 1",
        "1 39161U 13021C   24302.93579884  .00009494  00000-0  13268-2 0  9999",
        "2 39161  97.8142   5.3330 0009508 149.9634 210.2124 14.77794956616830",
        "0 POPACS 1",
        "1 39268U 13055D   24302.43236025  .00077845  33053-6  11177-2 0  9998",
        "2 39268  80.9780 356.6441 0349145  19.5916 341.8338 15.08383030581979",
        "0 POPACS 1",
        "1 39268U 13055D   24302.56502656  .00081873  45159-6  11757-2 0  9998",
        "2 39268  80.9776 356.4880 0349020  19.1565 342.2404 15.08408377580528",
        "0 POPACS 1",
        "1 39268U 13055D   24302.89668400  .00086772  60938-6  12454-2 0  9994",
        "2 39268  80.9776 356.0976 0348832  18.0616 343.2637 15.08460850580573",
        "0 POPACS 2",
        "1 39269U 13055E   24302.38628349  .00027130  00000-0  60106-3 0  9996",
        "2 39269  80.9969  94.1211 0524578 274.8306  79.3213 14.63251817575034",
        "0 POPACS 2",
        "1 39269U 13055E   24302.38628349  .00027130  00000-0  60106-3 0  9996",
        "2 39269  80.9969  94.1211 0524578 274.8306  79.3213 14.63251817576259",
        "0 POPACS 2",
        "1 39269U 13055E   24302.86494233  .00029809  00000-0  66019-3 0  9996",
        "2 39269  80.9976  93.5963 0524470 273.3557  80.7807 14.63279954575107",
        "0 POPACS 3",
        "1 39270U 13055F   24302.55742417  .00019807  00000-0  52274-3 0  9999",
        "2 39270  81.0048 149.2536 0612614  68.9507 297.6058 14.41033227552140",
        "0 POPACS 3",
        "1 39270U 13055F   24302.83515327  .00020203  00000-0  53321-3 0  9994",
        "2 39270  81.0046 148.9594 0612560  68.1239 298.3915 14.41044382552180",
        "0 ZACUBE",
        "1 39417U 13066B   24302.38212423  .00017930  00000-0  17260-2 0  9994",
        "2 39417  97.7500 255.6977 0050497  79.3807 281.3094 14.92047418591422",
        "0 ZACUBE",
        "1 39417U 13066B   24302.85156514  .00018570  00000-0  17865-2 0  9996",
        "2 39417  97.7500 256.1594 0050466  77.8916 282.7950 14.92064969591496",
        "0 ZACUBE",
        "1 39417U 13066B   24302.85156514  .00018570  00000-0  17865-2 0  9996",
        "2 39417  97.7500 256.1594 0050466  77.8916 282.7950 14.92064969591496",
        "0 WNISAT 1",
        "1 39423U 13066H   24302.44733486  .00004013  00000-0  76412-3 0  9998",
        "2 39423  97.6664 126.0299 0167226 310.9770  47.7062 14.55980671579824",
        "0 WNISAT 1",
        "1 39423U 13066H   24302.51605724  .00004197  00000-0  79864-3 0  9996",
        "2 39423  97.6664 126.0931 0167224 310.7627  47.9159 14.55981764579838",
        "0 WNISAT 1",
        "1 39423U 13066H   24302.99711435  .00004262  00000-0  81091-3 0  9993",
        "2 39423  97.6664 126.5356 0167172 309.2337  49.4123 14.55985764580112",
        "0 TRITON 1",
        "1 39427U 13066M   24302.15267543  .00014554  00000-0  19478-2 0  9995",
        "2 39427  97.8370 215.9684 0100371  14.5532 345.8530 14.76055947586003",
        "0 TRITON 1",
        "1 39427U 13066M   24302.49161646  .00016193  00000-0  21656-2 0  9991",
        "2 39427  97.8371 216.2972 0100270  13.4536 346.9311 14.76068130586050",
        "0 TRITON 1",
        "1 39427U 13066M   24302.55940448  .00016021  00000-0  21427-2 0  9999",
        "2 39427  97.8371 216.3630 0100261  13.2381 347.1424 14.76069909585870",
        "0 TRITON 1",
        "1 39427U 13066M   24302.76276753  .00016506  00000-0  22069-2 0  9994",
        "2 39427  97.8372 216.5603 0100232  12.5859 347.7818 14.76077422586090",
        "0 TRITON 1",
        "1 39427U 13066M   24302.89834248  .00016754  00000-0  22397-2 0  9996",
        "2 39427  97.8373 216.6918 0100214  12.1485 348.2108 14.76081683585925",
        "0 DELFI-N3XT",
        "1 39428U 13066N   24302.47684691  .00029631  00000-0  34426-2 0  9990",
        "2 39428  97.8332 217.5588 0096108  16.9088 343.5291 14.81974823585802",
        "0 GOMX 1",
        "1 39430U 13066Q   24302.11811739  .00009074  00000-0  14618-2 0  9999",
        "2 39430  97.7097 168.4246 0136304 189.1156 170.7572 14.65630066582505",
        "0 GOMX 1",
        "1 39430U 13066Q   24302.45947912  .00009099  00000-0  14655-2 0  9997",
        "2 39430  97.7095 168.7452 0136317 188.0262 171.8763 14.65635543582559",
        "0 GOMX 1",
        "1 39430U 13066Q   24302.59602333  .00008731  00000-0  14065-2 0  9994",
        "2 39430  97.7094 168.8734 0136334 187.5901 172.3243 14.65637676582395",
        "0 GOMX 1",
        "1 39430U 13066Q   24302.73256728  .00009036  00000-0  14551-2 0  9992",
        "2 39430  97.7094 169.0016 0136344 187.1514 172.7749 14.65640623582591",
        "0 GOMX 1",
        "1 39430U 13066Q   24302.86911114  .00008997  00000-0  14489-2 0  9998",
        "2 39430  97.7094 169.1298 0136349 186.7143 173.2240 14.65642834582433",
        "0 CUBEBUG 2",
        "1 39440U 13066AA  24302.10313684  .00014678  00000-0  16207-2 0  9997",
        "2 39440  97.8233 243.1723 0065808 197.3866 162.5097 14.85949444589254",
        "0 CUBEBUG 2",
        "1 39440U 13066AA  24302.57450733  .00014746  00000-0  16276-2 0  9997",
        "2 39440  97.8234 243.6359 0065839 195.7826 164.1339 14.85962583588128",
        "0 CUBEBUG 2",
        "1 39440U 13066AA  24302.77652179  .00014950  00000-0  16497-2 0  9999",
        "2 39440  97.8235 243.8345 0065850 195.1003 164.8248 14.85968977588152",
        "0 NEE 02 KRYSAOR",
        "1 39441U 13066AB  24302.48418990  .00009562  00000-0  11628-2 0  9993",
        "2 39441  97.8321 238.8342 0070619 221.1272 138.4606 14.81892894587667",
        "0 FUNCUBE 1",
        "1 39444U 13066AE  24302.12005810  .00026521  00000-0  23211-2 0  9995",
        "2 39444  97.7356 258.9768 0047587  59.4678 301.1228 14.95801965590546",
        "0 FUNCUBE 1",
        "1 39444U 13066AE  24302.32074281  .00023389  00000-0  20481-2 0  9990",
        "2 39444  97.7356 259.1750 0047548  58.8451 301.7420 14.95810241589982",
        "0 FUNCUBE 1",
        "1 39444U 13066AE  24302.85589518  .00026710  00000-0  23355-2 0  9996",
        "2 39444  97.7356 259.7037 0047482  57.0438 303.5335 14.95838961590064",
        "0 UWE-3",
        "1 39446U 13066AG  24302.33210920  .00014466  00000-0  15031-2 0  9996",
        "2 39446  97.7950 249.5288 0058776 139.4261 221.1359 14.88716761588498",
        "0 UWE-3",
        "1 39446U 13066AG  24302.33210920  .00014466  00000-0  15031-2 0  9996",
        "2 39446  97.7950 249.5288 0058776 139.4261 221.1359 14.88716761589084",
        "0 UWE-3",
        "1 39446U 13066AG  24302.39932275  .00015657  00000-0  16260-2 0  9994",
        "2 39446  97.7950 249.5950 0058790 139.2032 221.3609 14.88720200588509",
        "0 UWE-3",
        "1 39446U 13066AG  24302.80260231  .00016087  00000-0  16697-2 0  9998",
        "2 39446  97.7952 249.9919 0058836 137.8984 222.6776 14.88733154588568",
        "0 BRITE TORONTO",
        "1 40020U 14033L   24302.11035790  .00004728  00000-0  74986-3 0  9992",
        "2 40020  97.8962  74.7763 0082341  28.3926 332.1731 14.70357415554507",
        "0 BRITE TORONTO",
        "1 40020U 14033L   24302.31451154  .00004480  00000-0  71110-3 0  9991",
        "2 40020  97.8961  74.9741 0082324  27.7406 332.8156 14.70358553554536",
        "0 BRITE TORONTO",
        "1 40020U 14033L   24302.38256245  .00004776  00000-0  75744-3 0  9997",
        "2 40020  97.8962  75.0399 0082322  27.5250 333.0280 14.70359988554434",
        "0 BRITE TORONTO",
        "1 40020U 14033L   24302.38256245  .00004776  00000-0  75744-3 0  9997",
        "2 40020  97.8962  75.0399 0082322  27.5250 333.0280 14.70359988554546",
        "0 BRITE TORONTO",
        "1 40020U 14033L   24302.85891930  .00004769  00000-0  75627-3 0  9997",
        "2 40020  97.8964  75.5014 0082291  26.0077 334.5230 14.70364229554504",
        "0 DUCHIFAT 1",
        "1 40021U 14033M   24302.41120968  .00042794  00000-0  23378-2 0  9991",
        "2 40021  98.0998 293.7643 0012694  22.4988 337.6796 15.14105074564230",
        "0 DUCHIFAT 1",
        "1 40021U 14033M   24302.41120968  .00042794  00000-0  23378-2 0  9991",
        "2 40021  98.0998 293.7643 0012694  22.4988 337.6796 15.14105074564230",
        "0 DUCHIFAT 1",
        "1 40021U 14033M   24302.74163970  .00047647  00000-0  25984-2 0  9994",
        "2 40021  98.0995 294.1155 0012635  21.3678 338.8077 15.14137604564283",
        "0 DUCHIFAT 1",
        "1 40021U 14033M   24302.93989417  .00049691  00000-0  27073-2 0  9999",
        "2 40021  98.0994 294.3263 0012605  20.6319 339.5418 15.14159104564315",
        "0 NANOSAT C BR1",
        "1 40024U 14033Q   24302.39833261  .00031267  00000-0  19959-2 0  9991",
        "2 40024  98.0775 280.5943 0008856  82.1431 278.0801 15.08579975563292",
        "0 NANOSAT C BR1",
        "1 40024U 14033Q   24302.39833261  .00031267  00000-0  19959-2 0  9991",
        "2 40024  98.0775 280.5943 0008856  82.1431 278.0801 15.08579975563810",
        "0 QB50P1",
        "1 40025U 14033R   24302.37549371  .00022913  00000-0  16709-2 0  9994",
        "2 40025  98.0599 267.9710 0014901  90.9310 269.3621 15.03637535562866",
        "0 QB50P1",
        "1 40025U 14033R   24302.64167902  .00026253  00000-0  19121-2 0  9992",
        "2 40025  98.0600 268.2483 0014945  90.0974 270.1963 15.03651509563413",
        "0 QB50P1",
        "1 40025U 14033R   24302.90786194  .00026408  00000-0  19226-2 0  9999",
        "2 40025  98.0600 268.5256 0014976  89.3117 270.9823 15.03665283562942",
        "0 QB50P2",
        "1 40032U 14033Y   24302.33535428  .00022238  00000-0  16900-2 0  9999",
        "2 40032  98.0174 258.6785 0012159  50.3109 309.9185 15.02111348563158",
        "0 QB50P2",
        "1 40032U 14033Y   24302.60180974  .00024864  00000-0  18876-2 0  9992",
        "2 40032  98.0174 258.9541 0012139  49.4427 310.7852 15.02124432562676",
    ]
    reference_time = datetime(2024, 10, 28, 8, 54, 0, tzinfo=timezone.utc)
    # São José dos Campos
    receiver_pos = wgs84.latlon(-23.20713241666, -45.861737777, 605.088)

    from scintpy import setup_log
    from scintpy.geom import get_scenario, plot_sat_orbits
    from scintpy.geom.orbit_propagation import _get_sats, _yield_LOS_sats

    setup_log("TRACE")

    sats = _get_sats(mock_space_track_tles)

    scenarios = []
    while len(scenarios) < 10:
        for sat, rise_time, set_time in _yield_LOS_sats(
            sats, reference_time, receiver_pos, 5
        ):
            # if the satellite is already in the list, continue the for loop and search
            # for the next in line-of-sight satellite
            if sat.name in [scenario.satellite.name for scenario in scenarios]:
                continue
            scenarios.append(get_scenario(sat, receiver_pos, rise_time, set_time))
            # get only 10 satellites
            if len(scenarios) == 10:
                break
        # for the given reference time, there are too few LOS satellites
        # search if again for another reference time
        reference_time += timedelta(minutes=30)

    plot_sat_orbits(scenarios, reference_time)
    # NOTE: that is a visual test.
